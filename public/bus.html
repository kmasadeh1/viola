<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viola Academy | Bus Tracking</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        .route-header {
            background: linear-gradient(135deg, #2c3e50, #c0392b);
            color: white; padding: 40px 0; border-radius: 0 0 20px 20px; margin-bottom: 30px;
            text-align: center;
        }

        /* Map & Bus Icon Styling */
        .map-container { position: relative; height: 450px; width: 100%; overflow: hidden; border-radius: 0 0 5px 5px; }
        .bus-marker {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10;
            background: #fff; padding: 5px; border-radius: 50%; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            animation: floatBus 3s ease-in-out infinite;
        }
        .bus-icon-img {
            width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;
            background: #f1c40f; color: #333; border-radius: 50%; border: 3px solid #fff; font-size: 1.5rem;
        }
        .bus-pulse {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60px; height: 60px; border-radius: 50%; border: 2px solid #f1c40f;
            animation: pulse-ring 2s infinite; z-index: 9;
        }
        @keyframes pulse-ring { 0% { width: 60px; height: 60px; opacity: 1; } 100% { width: 100px; height: 100px; opacity: 0; } }
        @keyframes floatBus { 0%, 100% { transform: translate(-50%, -55%); } 50% { transform: translate(-50%, -45%); } }

        /* Timeline Styling */
        .timeline { position: relative; padding-left: 30px; border-left: 3px solid #e9ecef; margin-left: 10px; }
        .timeline-item { position: relative; margin-bottom: 25px; }
        .timeline-dot { position: absolute; left: -38px; top: 5px; width: 14px; height: 14px; background: #fff; border: 3px solid #c0392b; border-radius: 50%; }
        .timeline-dot.completed { background: #2ecc71; border-color: #2ecc71; }
        .timeline-content { background: white; padding: 12px 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        /* Floating Language Toggle */
        .lang-toggle {
            position: fixed; bottom: 30px; right: 30px; z-index: 1000;
            background: white; padding: 10px 20px; border-radius: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15); cursor: pointer;
            border: 2px solid #c0392b; font-weight: bold; color: #c0392b;
            transition: transform 0.2s; display: flex; align-items: center; gap: 8px;
        }
        .lang-toggle:hover { transform: scale(1.05); }

        /* RTL Adjustments */
        [dir="rtl"] { text-align: right; }
        [dir="rtl"] .lang-toggle { right: auto; left: 30px; }
        [dir="rtl"] .timeline { padding-left: 0; padding-right: 30px; border-left: none; border-right: 3px solid #e9ecef; margin-left: 0; margin-right: 10px; }
        [dir="rtl"] .timeline-dot { left: auto; right: -38px; }
    </style>
</head>
<body>

    <div class="lang-toggle" onclick="toggleLanguage()">
        <i class="fas fa-globe"></i> <span id="langLabel">English / العربية</span>
    </div>

    <div class="route-header">
        <div class="container position-relative">
            <div class="position-absolute top-50 start-0 translate-middle-y d-none d-md-block">
                <a href="parent_dashboard.html" class="btn btn-outline-light rounded-pill px-4">
                    <i class="fas fa-arrow-left me-2"></i><span data-en="Back to Dashboard" data-ar="عودة للوحة التحكم">Back to Dashboard</span>
                </a>
            </div>

            <h1 class="fw-bold mb-2">
                <i class="fas fa-bus-alt me-2"></i>
                <span data-en="Bus Route #4 (Irbid)" data-ar="مسار الحافلة 4 (إربد)">Bus Route #4 (Irbid)</span>
            </h1>
            <p class="mb-0 opacity-90" data-en="Live GPS Tracking System" data-ar="نظام تتبع مباشر GPS">Live GPS Tracking System</p>

            <div class="d-md-none mt-3">
                <a href="parent_dashboard.html" class="btn btn-sm btn-outline-light rounded-pill">
                    <i class="fas fa-arrow-left me-1"></i><span data-en="Back" data-ar="عودة">Back</span>
                </a>
            </div>
        </div>
    </div>

    <div class="container mb-5">
        
        <div class="card shadow-sm border-0 mb-4 overflow-hidden">
            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                <h5 class="mb-0 fw-bold text-danger">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    <span data-en="Live Location" data-ar="الموقع المباشر">Live Location</span>
                </h5>
                <span class="badge bg-danger px-3 py-2" data-en="LIVE" data-ar="مباشر">LIVE</span>
            </div>
            
            <div class="card-body p-0">
                <div class="map-container">
                    <div class="bus-pulse"></div>
                    <div class="bus-marker">
                        <div class="bus-icon-img"><i class="fas fa-bus"></i></div>
                        <div class="text-center fw-bold small mt-1 bg-white px-2 rounded shadow-sm" data-en="Bus #4" data-ar="حافلة 4">Bus #4</div>
                    </div>
                    <iframe 
                        src="https://maps.google.com/maps?q=Irbid,Jordan&t=&z=13&ie=UTF8&iwloc=&output=embed" 
                        width="100%" 
                        height="450" 
                        style="border:0;" 
                        allowfullscreen="" 
                        loading="lazy">
                    </iframe>
                </div>
            </div>
            <div class="card-footer bg-light d-flex justify-content-between align-items-center">
                <small class="text-muted"><i class="fas fa-tachometer-alt me-1"></i> <span data-en="Speed: 45 km/h" data-ar="السرعة: 45 كم/س">Speed: 45 km/h</span></small>
                <small class="text-muted"><i class="fas fa-clock me-1"></i> <span data-en="Updated: Just now" data-ar="تحديث: الآن">Updated: Just now</span></small>
            </div>
        </div>

        <div class="row g-4">
            
            <div class="col-md-4 order-md-2">
                <div class="card shadow-sm border-0 mb-3">
                    <div class="card-body text-center">
                        <div style="width: 80px; height: 80px; background: #eee; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-user-tie fs-1 text-secondary"></i>
                        </div>
                        <h5 class="fw-bold" data-en="Mr. Khaled Al-Omari" data-ar="السيد خالد العمري">Mr. Khaled Al-Omari</h5>
                        <p class="text-muted small">
                            <span data-en="Route: Irbid City Center" data-ar="المسار: وسط مدينة إربد">Route: Irbid City Center</span>
                        </p>
                        <a href="tel:+962790000000" class="btn btn-success w-100 rounded-pill mb-2">
                            <i class="fas fa-phone-alt me-2"></i><span data-en="Call Driver" data-ar="اتصل بالسائق">Call Driver</span>
                        </a>
                        <div class="alert alert-info small mb-0 mt-2">
                            <i class="fas fa-info-circle me-1"></i> <span data-en="Bus is On Schedule" data-ar="الحافلة في الموعد">Bus is On Schedule</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-8 order-md-1">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-white py-3">
                        <ul class="nav nav-pills card-header-pills" id="pills-tab" role="tablist">
                            <li class="nav-item">
                                <button class="nav-link active" id="morning-tab" data-bs-toggle="pill" data-bs-target="#morning" type="button" data-en="Morning" data-ar="صباحي">Morning</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" id="evening-tab" data-bs-toggle="pill" data-bs-target="#evening" type="button" data-en="Afternoon" data-ar="مسائي">Afternoon</button>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="card-body p-4">
                        <div class="tab-content" id="pills-tabContent">
                            
                            <div class="tab-pane fade show active" id="morning">
                                <h6 class="mb-4 text-muted border-bottom pb-2" data-en="Pick-up Route" data-ar="مسار الذهاب">Pick-up Route</h6>
                                <div class="timeline" id="morningTimeline">
                                    <p class="text-muted text-center">Loading route...</p>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="evening">
                                <h6 class="mb-4 text-muted border-bottom pb-2" data-en="Drop-off Route" data-ar="مسار العودة">Drop-off Route</h6>
                                <div class="timeline" id="eveningTimeline">
                                     <p class="text-muted text-center">Loading route...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let isArabic = false;
        
        // 1. Load Data
        const busData = JSON.parse(localStorage.getItem('viola_bus_data')) || { morning: [], evening: [] };

        // Fallback data if empty
        if (busData.morning.length === 0 && busData.evening.length === 0) {
            busData.morning = [
                { time: "06:30", loc: "Housing Bank Circle" },
                { time: "07:00", loc: "Nuwayjis Intersection" },
                { time: "07:30", loc: "Signal 2 (Bakery)" },
                { time: "07:55", loc: "Viola Academy" }
            ];
            busData.evening = [
                { time: "14:00", loc: "Viola Academy" },
                { time: "14:30", loc: "Signal 2 (Bakery)" },
                { time: "15:00", loc: "Nuwayjis Intersection" },
                { time: "15:30", loc: "Housing Bank Circle" }
            ];
        }

        // 2. Render Timelines
        function renderRoutes() {
            renderTimeline('morning', 'morningTimeline');
            renderTimeline('evening', 'eveningTimeline');
        }

        function renderTimeline(type, containerId) {
            const container = document.getElementById(containerId);
            const route = busData[type];
            
            if (!route || route.length === 0) {
                container.innerHTML = `<p class="text-muted" data-en="No stops added." data-ar="لم تتم إضافة محطات.">No stops added.</p>`;
                return;
            }

            const now = new Date();
            const currentTimeVal = now.getHours() * 60 + now.getMinutes();

            let html = '';
            
            route.forEach(stop => {
                const [h, m] = stop.time.split(':').map(Number);
                const stopTimeVal = h * 60 + m;
                const isCompleted = currentTimeVal > stopTimeVal; 
                const dotClass = isCompleted ? 'timeline-dot completed' : 'timeline-dot';
                
                html += `
                    <div class="timeline-item">
                        <div class="${dotClass}"></div>
                        <div class="timeline-content d-flex justify-content-between align-items-center">
                            <span>${stop.loc}</span>
                            <span class="badge bg-light text-dark border">${stop.time}</span>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // 3. Language Toggle
        function toggleLanguage() {
            isArabic = !isArabic;
            const lang = isArabic ? 'ar' : 'en';
            
            document.documentElement.setAttribute('dir', isArabic ? 'rtl' : 'ltr');
            document.documentElement.setAttribute('lang', lang);

            document.querySelectorAll('[data-en]').forEach(el => {
                el.innerText = el.getAttribute(`data-${lang}`);
            });
            
            renderRoutes();
        }

        window.onload = function() {
            renderRoutes();
        };
    </script>
</body>
</html>