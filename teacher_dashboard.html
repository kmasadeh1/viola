<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Workspace | Viola Academy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #2ecc71;
            --warning-color: #f1c40f;
            --danger-color: #e74c3c;
            --light-bg: #f8f9fa;
            --card-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        body { background-color: #f3f4f6; font-family: 'Inter', sans-serif; color: #2d3436; }

        /* PREVIEW BANNER */
        #adminPreviewBanner {
            background-color: #f1c40f; color: #333; text-align: center;
            padding: 12px; font-weight: 700; position: sticky; top: 0; z-index: 9999;
            display: none; justify-content: center; align-items: center; gap: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* HEADER */
        .dashboard-header {
            background: white; padding: 20px 0;
            box-shadow: 0 2px 15px rgba(0,0,0,0.03);
        }

        /* CARDS */
        .stat-card {
            background: white; border-radius: 16px; padding: 25px;
            box-shadow: var(--card-shadow); border: none;
            transition: transform 0.2s ease; height: 100%;
        }
        .stat-card:hover { transform: translateY(-3px); }
        .stat-icon {
            width: 50px; height: 50px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; margin-bottom: 15px;
        }

        /* TABS */
        .nav-pills .nav-link {
            color: #636e72; font-weight: 600; padding: 10px 20px;
            border-radius: 10px; margin-right: 10px; transition: all 0.3s;
        }
        .nav-pills .nav-link.active {
            background-color: var(--primary-color); color: white;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }
        
        .tab-content-card {
            background: white; border-radius: 20px; padding: 30px;
            box-shadow: var(--card-shadow); min-height: 500px;
        }

        /* INPUTS & CONTROLS */
        .form-control, .form-select {
            border-radius: 10px; border: 1px solid #e1e8ed; padding: 10px 15px;
        }
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        /* ATTENDANCE TOGGLES */
        .btn-check:checked + .btn-outline-success { background-color: var(--success-color); border-color: var(--success-color); color: white; }
        .btn-check:checked + .btn-outline-warning { background-color: var(--warning-color); border-color: var(--warning-color); color: white; }
        .btn-check:checked + .btn-outline-danger { background-color: var(--danger-color); border-color: var(--danger-color); color: white; }
        .btn-outline-success, .btn-outline-warning, .btn-outline-danger { border-radius: 8px; width: 40px; height: 35px; display: inline-flex; align-items: center; justify-content: center; border-width: 1px; }

        /* ROSTER SIDEBAR */
        .roster-card {
            background: white; border-radius: 20px; box-shadow: var(--card-shadow);
            overflow: hidden; height: calc(100vh - 140px); position: sticky; top: 100px;
        }
        .roster-item {
            padding: 12px 20px; border-bottom: 1px solid #f5f6fa;
            transition: background 0.2s; cursor: pointer;
        }
        .roster-item:hover { background-color: #f8f9fa; }
        
        .avatar-circle { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .avatar-lg { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid #e1e8ed; }

        /* GRADES */
        .grade-input { 
            width: 70px; text-align: center; font-weight: 700; border-radius: 8px; 
            border: 1px solid #e1e8ed; padding: 8px; transition: all 0.2s;
        }
        .grade-input:focus { border-color: var(--primary-color); background: #f0f4ff; }

        /* UPLOAD */
        .upload-area {
            border: 2px dashed #cbd5e0; border-radius: 15px; padding: 40px;
            text-align: center; cursor: pointer; transition: all 0.3s; background: #fafafa;
        }
        .upload-area:hover { border-color: var(--primary-color); background: #f0f4ff; transform: scale(1.01); }

        /* TOAST */
        #toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 9999; }
        .toast-pill {
            background: #333; color: white; padding: 12px 25px; border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 10px;
            animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* LANGUAGE BTN */
        .lang-btn {
            position: fixed; bottom: 30px; right: 30px; background: white;
            padding: 10px 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer; font-weight: 600; color: var(--primary-color); z-index: 1000;
        }

        [dir="rtl"] { text-align: right; }
        [dir="rtl"] .nav-pills .nav-link { margin-right: 0; margin-left: 10px; }
        [dir="rtl"] .lang-btn { right: auto; left: 30px; }
        
        /* Schedule Table */
        .schedule-table th { background-color: #f8f9fa; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px; }
        .schedule-badge { font-weight: bold; background-color: #e3f2fd; color: #4361ee; padding: 5px 10px; border-radius: 20px; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div id="adminPreviewBanner">
        <span><i class="fas fa-edit"></i> Admin Edit Mode (Acting as Teacher)</span>
        <button class="btn btn-sm btn-dark rounded-pill px-3" onclick="exitPreview()">Exit Preview</button>
    </div>

    <header class="dashboard-header">
        <div class="container-fluid px-lg-5">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-4">
                    <h3 class="fw-bold mb-0 text-dark"><i class="fas fa-shapes text-primary me-2"></i> Viola<span class="text-primary">Teach</span></h3>
                    <div class="vr mx-2 d-none d-md-block"></div>
                    <div class="d-flex align-items-center bg-light rounded-pill px-3 py-1">
                        <span class="text-muted small me-2 text-uppercase fw-bold" style="font-size: 0.7rem;" data-en="Classroom" data-ar="الصف">Classroom</span>
                        <select id="classSelector" class="form-select border-0 bg-transparent py-0 fw-bold text-dark shadow-none" 
                                style="width: auto; cursor: default; pointer-events: none; background-image: none; padding-right: 0;" 
                                disabled>
                            </select>
                    </div>
                </div>
                
                <div class="d-flex align-items-center gap-3">
                    <div class="text-end d-none d-md-block">
                        <h6 class="mb-0 fw-bold" id="teacherName">Ms. Sarah</h6>
                        <small class="text-muted" data-en="Head Teacher" data-ar="معلمة صف">Head Teacher</small>
                    </div>
                    <img src="https://ui-avatars.com/api/?name=Sarah+Teacher&background=random" class="avatar-circle">
                    <a href="login.html" class="btn btn-light rounded-circle" id="logoutBtn" title="Logout"><i class="fas fa-sign-out-alt text-danger"></i></a>
                </div>
            </div>
        </div>
    </header>

    <div class="container-fluid px-lg-5 py-4">
        
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="stat-card d-flex align-items-center justify-content-between">
                    <div>
                        <small class="text-muted text-uppercase fw-bold" style="font-size: 0.75rem;" data-en="Attendance Today" data-ar="الحضور اليوم">Attendance Today</small>
                        <h2 class="mb-0 fw-bold mt-1" id="attendanceCount">0/0</h2>
                    </div>
                    <div class="stat-icon bg-success-subtle text-success"><i class="fas fa-user-check"></i></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card d-flex align-items-center justify-content-between">
                    <div>
                        <small class="text-muted text-uppercase fw-bold" style="font-size: 0.75rem;" data-en="Active Homework" data-ar="واجبات نشطة">Active Homework</small>
                        <h2 class="mb-0 fw-bold mt-1" id="activeHwCount">0</h2>
                    </div>
                    <div class="stat-icon bg-info-subtle text-info"><i class="fas fa-book-open"></i></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card d-flex align-items-center justify-content-between">
                    <div>
                        <small class="text-muted text-uppercase fw-bold" style="font-size: 0.75rem;" data-en="Next Session" data-ar="الحصة القادمة">Next Session</small>
                        <h4 class="mb-0 fw-bold mt-1" id="nextSessionDisplay" data-en="--" data-ar="--">--</h4>
                    </div>
                    <div class="stat-icon bg-warning-subtle text-warning"><i class="fas fa-clock"></i></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card d-flex align-items-center justify-content-between">
                    <div>
                        <small class="text-muted text-uppercase fw-bold" style="font-size: 0.75rem;" data-en="Date" data-ar="التاريخ">Date</small>
                        <h5 class="mb-0 fw-bold mt-1" id="currentDateDisplay">--</h5>
                    </div>
                    <div class="stat-icon bg-secondary-subtle text-secondary"><i class="fas fa-calendar-day"></i></div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            
            <div class="col-lg-9">
                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                    <li class="nav-item"><button class="nav-link active" id="tab-attendance" data-bs-toggle="pill" data-bs-target="#content-attendance" type="button"><i class="fas fa-tasks me-2"></i> <span data-en="Attendance" data-ar="الحضور">Attendance</span></button></li>
                    <li class="nav-item"><button class="nav-link" id="tab-schedule" data-bs-toggle="pill" data-bs-target="#content-schedule" type="button"><i class="fas fa-calendar-alt me-2"></i> <span data-en="My Schedule" data-ar="جدولي">My Schedule</span></button></li>
                    <li class="nav-item"><button class="nav-link" id="tab-grades" data-bs-toggle="pill" data-bs-target="#content-grades" type="button"><i class="fas fa-star me-2"></i> <span data-en="Gradebook" data-ar="الدرجات">Gradebook</span></button></li>
                    <li class="nav-item"><button class="nav-link" id="tab-homework" data-bs-toggle="pill" data-bs-target="#content-homework" type="button"><i class="fas fa-pencil-alt me-2"></i> <span data-en="Homework" data-ar="الواجبات">Homework</span></button></li>
                    <li class="nav-item"><button class="nav-link" id="tab-gallery" data-bs-toggle="pill" data-bs-target="#content-gallery" type="button"><i class="fas fa-camera me-2"></i> <span data-en="Gallery" data-ar="الصور">Gallery</span></button></li>
                    <li class="nav-item"><button class="nav-link" id="tab-broadcast" data-bs-toggle="pill" data-bs-target="#content-broadcast" type="button"><i class="fas fa-bullhorn me-2"></i> <span data-en="Broadcast" data-ar="الإعلانات">Broadcast</span></button></li>
                </ul>

                <div class="tab-content tab-content-card" id="pills-tabContent">
                    
                    <div class="tab-pane fade show active" id="content-attendance">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4 class="fw-bold mb-0 text-dark" data-en="Daily Attendance" data-ar="سجل الحضور">Daily Attendance</h4>
                            <div class="d-flex gap-2">
                                <input type="date" id="attendanceDatePicker" class="form-control" style="width: auto;">
                                <button class="btn btn-outline-primary" onclick="markAllPresent()"><i class="fas fa-check-double me-2"></i> <span data-en="Mark All Present" data-ar="تحديد الكل">Mark All Present</span></button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table align-middle table-hover">
                                <thead class="text-muted small text-uppercase bg-light">
                                    <tr>
                                        <th class="ps-3 border-0 rounded-start" data-en="Student" data-ar="الطالب">Student</th>
                                        <th class="text-center border-0 rounded-end" data-en="Status" data-ar="الحالة">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="attendanceTableBody" class="border-top-0"></tbody>
                            </table>
                        </div>
                        <div class="mt-4 text-end">
                            <button class="btn btn-primary px-5 rounded-pill fw-bold" onclick="saveAttendance()">
                                <i class="fas fa-save me-2"></i> <span data-en="Save Records" data-ar="حفظ السجل">Save Records</span>
                            </button>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="content-schedule">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4 class="fw-bold mb-0 text-dark" data-en="My Weekly Schedule" data-ar="جدولي الأسبوعي">My Weekly Schedule</h4>
                        </div>
                        <div class="table-responsive">
                            <table class="table align-middle table-hover schedule-table">
                                <thead class="bg-light text-muted">
                                    <tr>
                                        <th data-en="Day" data-ar="اليوم">Day</th>
                                        <th data-en="Time" data-ar="الوقت">Time</th>
                                        <th data-en="Class" data-ar="الصف">Class</th>
                                        <th data-en="Subject" data-ar="المادة">Subject</th>
                                    </tr>
                                </thead>
                                <tbody id="teacherScheduleBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="content-grades">
                        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
                            <div class="d-flex align-items-center gap-3">
                                <h4 class="fw-bold mb-0 text-dark" data-en="Gradebook" data-ar="دفتر الدرجات">Gradebook</h4>
                                <select id="termSelect" class="form-select fw-bold bg-light border-0 text-primary" style="width: auto;" onchange="changeTerm()">
                                    <option value="First Semester" data-en="First Semester" data-ar="الفصل الأول">First Semester</option>
                                    <option value="Second Semester" data-en="Second Semester" data-ar="الفصل الثاني">Second Semester</option>
                                </select>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <input type="text" id="newSubjectInput" class="form-control" placeholder="New Subject (e.g. Art)" style="width: 200px;" data-en-ph="New Subject (e.g. Art)" data-ar-ph="مادة جديدة (مثل الفن)">
                                <button class="btn btn-sm btn-outline-primary fw-bold" onclick="addSubject()">
                                    <i class="fas fa-plus"></i> <span data-en="Add" data-ar="إضافة">Add</span>
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table align-middle">
                                <thead class="text-muted small text-uppercase bg-light" id="gradesTableHeader"></thead>
                                <tbody id="gradesTableBody"></tbody>
                            </table>
                        </div>
                        <div class="mt-4 text-end">
                            <button class="btn btn-primary px-5 rounded-pill fw-bold" onclick="saveGrades()">
                                <i class="fas fa-save me-2"></i> <span data-en="Update Grades" data-ar="تحديث الدرجات">Update Grades</span>
                            </button>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="content-homework">
                        <div class="row g-4">
                            <div class="col-md-5 border-end">
                                <h5 class="fw-bold mb-3" data-en="Post New Assignment" data-ar="نشر واجب جديد">Post New Assignment</h5>
                                <div class="mb-3">
                                    <label class="small fw-bold text-muted mb-1" data-en="Subject" data-ar="المادة">Subject</label>
                                    <select id="hwSubject" class="form-select bg-light border-0">
                                        </select>
                                </div>
                                <div class="mb-3">
                                    <label class="small fw-bold text-muted mb-1" data-en="Due Date" data-ar="تاريخ التسليم">Due Date</label>
                                    <input type="date" id="hwDate" class="form-control bg-light border-0">
                                </div>
                                <div class="mb-3">
                                    <label class="small fw-bold text-muted mb-1" data-en="Instructions" data-ar="التعليمات">Instructions</label>
                                    <textarea id="hwDesc" class="form-control bg-light border-0" rows="4" placeholder="e.g. Complete worksheet page 12..."></textarea>
                                </div>
                                <button class="btn btn-primary w-100 rounded-pill fw-bold" onclick="postHomework()">
                                    <i class="fas fa-paper-plane me-2"></i> <span data-en="Post to Parents" data-ar="نشر لأولياء الأمور">Post to Parents</span>
                                </button>
                            </div>
                            <div class="col-md-7 ps-md-4">
                                <h5 class="fw-bold mb-3" data-en="Active Assignments" data-ar="الواجبات النشطة">Active Assignments</h5>
                                <div id="homeworkListContainer" class="d-flex flex-column gap-2"></div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="content-gallery">
                        <div class="text-center py-4">
                            <h4 class="fw-bold mb-3" data-en="Classroom Moments" data-ar="لحظات الصف">Classroom Moments</h4>
                            <p class="text-muted mb-4" data-en="Share photos directly to the parent portal." data-ar="شارك الصور مباشرة مع أولياء الأمور.">Share photos directly to the parent portal.</p>
                            <form id="uploadForm" class="mx-auto" style="max-width: 500px;">
                                <div class="upload-area mb-3" id="dropZoneGallery">
                                    <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                                    <h6 class="fw-bold">Click to Upload</h6>
                                    <img id="galleryPreview" class="preview-img img-fluid rounded mt-3" style="display:none; max-height: 200px;">
                                    <input type="file" id="galleryInput" accept="image/*" hidden>
                                </div>
                                <div class="input-group mb-3">
                                    <span class="input-group-text bg-white border-end-0"><i class="fas fa-pen text-muted"></i></span>
                                    <input type="text" id="photoCaption" class="form-control border-start-0 ps-0" placeholder="Caption (e.g. Science Experiment)" required>
                                </div>
                                <button type="submit" class="btn btn-primary w-100 rounded-pill fw-bold">
                                    <i class="fas fa-share-square me-2"></i> <span data-en="Publish Photo" data-ar="نشر الصورة">Publish Photo</span>
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="content-broadcast">
                        <div class="row g-4">
                            <div class="col-md-6 mx-auto">
                                <div class="text-center mb-4">
                                    <h4 class="fw-bold text-dark" data-en="Send Broadcast" data-ar="إرسال إعلان">Send Broadcast</h4>
                                    <p class="text-muted" data-en="Send updates to the whole class or specific students." data-ar="إرسال تحديثات للصف كامل أو لطلاب محددين.">Send updates to the whole class or specific students.</p>
                                </div>
                                
                                <div class="card border-0 shadow-sm p-4 rounded-4">
                                    <div class="mb-3">
                                        <label class="fw-bold text-muted small mb-1" data-en="Recipient" data-ar="المستلم">Recipient</label>
                                        <select id="broadcastRecipient" class="form-select bg-light border-0 fw-bold">
                                            </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="fw-bold text-muted small mb-1" data-en="Title" data-ar="العنوان">Title</label>
                                        <input type="text" id="broadcastTitle" class="form-control bg-light border-0" placeholder="e.g. Field Trip Update">
                                    </div>
                                    <div class="mb-3">
                                        <label class="fw-bold text-muted small mb-1" data-en="Message" data-ar="الرسالة">Message</label>
                                        <textarea id="broadcastBody" class="form-control bg-light border-0" rows="5" placeholder="Type your message here..."></textarea>
                                    </div>
                                    <button class="btn btn-primary w-100 rounded-pill fw-bold py-2" onclick="sendTeacherBroadcast()">
                                        <i class="fas fa-paper-plane me-2"></i> <span data-en="Send Message" data-ar="إرسال الرسالة">Send Message</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="col-lg-3">
                <div class="roster-card">
                    <div class="p-3 border-bottom bg-white sticky-top">
                        <h6 class="fw-bold mb-0 text-uppercase text-muted small" data-en="Class Roster" data-ar="قائمة الطلاب">Class Roster</h6>
                    </div>
                    <div style="overflow-y: auto; height: 100%;" id="rosterList"></div>
                </div>
            </div>

        </div>
    </div>

    <div class="modal fade" id="studentPhotoModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content rounded-4 border-0 overflow-hidden">
                <div class="modal-body text-center p-4">
                    <img id="currentStudentImg" src="" class="avatar-lg mb-3 shadow-sm">
                    <h5 id="modalStudentName" class="fw-bold mb-4">Student Name</h5>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary rounded-pill" onclick="document.getElementById('studentFileInput').click()">
                            <i class="fas fa-camera me-2"></i> <span data-en="Change Photo" data-ar="تغيير الصورة">Change Photo</span>
                        </button>
                        <input type="file" id="studentFileInput" accept="image/*" hidden onchange="previewStudentPhoto(this)">
                    </div>
                    <div id="studentPreviewContainer" class="mt-3" style="display:none;">
                        <small class="text-success d-block mb-2 fw-bold">Preview:</small>
                        <img id="studentPreview" class="avatar-lg mb-3">
                        <button class="btn btn-success w-100 rounded-pill" onclick="saveStudentPhoto()">
                            <i class="fas fa-check me-2"></i> <span data-en="Confirm" data-ar="تأكيد">Confirm</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>
    <div class="lang-btn" onclick="toggleLanguage()"><i class="fas fa-globe me-2"></i> <span id="langLabel">العربية</span></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="module" src="js/teacher_dashboard.js"></script>
</body>
</html>
